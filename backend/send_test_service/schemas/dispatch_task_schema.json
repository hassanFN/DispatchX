{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://yourdomain.com/schemas/dispatch-task.json",
  "title": "Dispatch Task Message",
  "description": "Validated contract for messages on the 'dispatch-tasks' Kafka topic.",
  "type": "object",
  "required": [
    "schema_version",
    "task_id",
    "order_id",
    "pickup",
    "dropoff",
    "timestamp",
    "status"
  ],
  "properties": {
    "schema_version": {
      "type": "integer",
      "minimum": 1,
      "description": "Increment this when making breaking changes."
    },
    "task_id": {
      "type": "string",
      "pattern": "^[A-Za-z0-9\\-]+$",
      "description": "Unique task identifier."
    },
    "order_id": {
      "type": ["string", "integer"],
      "description": "External order reference."
    },
    "pickup": {
      "type": "object",
      "required": ["address", "lat", "lon"],
      "properties": {
        "address": { "type": "string" },
        "lat": {
          "type": "number",
          "minimum": -90,
          "maximum": 90
        },
        "lon": {
          "type": "number",
          "minimum": -180,
          "maximum": 180
        }
      }
    },
    "dropoff": {
      "type": "object",
      "required": ["address", "lat", "lon"],
      "properties": {
        "address": { "type": "string" },
        "lat": {
          "type": "number",
          "minimum": -90,
          "maximum": 90
        },
        "lon": {
          "type": "number",
          "minimum": -180,
          "maximum": 180
        }
      }
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 task creation timestamp."
    },
    "status": {
      "type": "string",
      "enum": ["pending", "assigned", "in_transit", "delivered", "failed"],
      "description": "Current lifecycle state."
    },
    "priority": {
      "type": "string",
      "enum": ["low", "normal", "high"],
      "default": "normal"
    },
    "assignee_id": {
      "type": ["string", "null"],
      "description": "Driver/courier ID once assigned."
    },
    "eta_minutes": {
      "type": "integer",
      "minimum": 0,
      "description": "Estimated time in minutes from assignment to completion."
    },
    "instructions": {
      "type": "string",
      "description": "Optional delivery instructions."
    },
    "metadata": {
      "type": "object",
      "description": "Catch-all for future fields.",
      "additionalProperties": true
    }
  },
  "additionalProperties": false
}
